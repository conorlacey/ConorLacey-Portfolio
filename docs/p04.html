<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Portfolio 4</title>

<script src="site_libs/header-attrs-2.20/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>









<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Portfolio</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="p01.html">Portfolio 1</a>
</li>
<li>
  <a href="p02.html">Portfolio 2</a>
</li>
<li>
  <a href="p03.html">Portfolio 3</a>
</li>
<li>
  <a href="p04.html">Portfolio 4</a>
</li>
<li>
  <a href="p05.html">Portfolio 5</a>
</li>
<li>
  <a href="p06.html">Portfolio 6</a>
</li>
<li>
  <a href="p07.html">Portfolio 7</a>
</li>
<li>
  <a href="p08.html">Portfolio 8</a>
</li>
<li>
  <a href="p09.html">Portfolio 9</a>
</li>
<li>
  <a href="p10.html">Portfolio 10</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">



<h1 class="title toc-ignore">Portfolio 4</h1>

</div>


<div id="introduction" class="section level3">
<h3>Introduction</h3>
<p>This portfolio will demonstrate how dMACS shrunk works with code.</p>
</div>
<div id="create-invariant-items" class="section level3">
<h3>Create invariant items</h3>
<pre class="r"><code>set.seed(55555)

library(dmacs)

eta &lt;- seq(-1000,1000, by = 10) #Generate true scores
load.R &lt;- .6 #loading for the reference group
load.F &lt;- 1.2 #loading for focal group
int.R &lt;- 0 #intercept for reference group
int.F &lt;- 1 #intercept for focal group

y.R &lt;- load.R*eta + int.R #model-implied scores for reference group
y.F &lt;- load.F*eta + int.F #model-implied scores for focal group

sd.pooled.test.num &lt;- ((length(y.R)-1)*sd(y.R)) + ((length(y.F)-1)*sd(y.F)) 
sd.pooled.test.denom &lt;- (length(y.R) - 1) + (length(y.F) - 1)
sd.pooled.test &lt;- sd.pooled.test.num/sd.pooled.test.denom</code></pre>
</div>
<div id="calculate-initial-observed-dmacs" class="section level3">
<h3>Calculate initial observed dMACS</h3>
<p>The method I demonstrate here is the method created by Nye &amp;
Drasgow, (2011)</p>
<pre class="r"><code>item_dmacs(.6, #loading, R 
      1.2, #loading, F
      0, #intercept, R
      1, #intercept, F
      mean(eta), #mean (both groups)
      var(eta), #variance (both groups, but it would be the focal group if they didn&#39;t have the same variance)
      sd.pooled.test #pooled standard deviation (again, this is basically arbitrary)
      )</code></pre>
<pre><code>## [1] 0.6666694</code></pre>
</div>
<div id="update-parameter" class="section level3">
<h3>Update Parameter</h3>
<p>Ok now I will define some function’s from Bergh et al., (2021).</p>
<pre class="r"><code>get.dMACS &lt;- function(outcome.R, outcome.F, eta = Eta) {
  lm.R &lt;- lm(outcome.R ~ eta)$coefficients
  lm.F &lt;- lm(outcome.F ~ eta)$coefficients
  load.R &lt;- lm.R[2]
  int.R &lt;- lm.R[1]
  load.F &lt;- lm.F[2]
  int.F &lt;- lm.F[2]
  integrand &lt;- function(x){
    product&lt;-(load.R*x + int.R) - (load.F*x + int.F)
    return((product^2)*dnorm(x,mean(eta), sd(eta)))
  }
  inside.sqrt&lt;- integrate(integrand, (min(eta)-10000), (max(eta)+10000))$value
  sd.pooled.num &lt;- ((length(outcome.R)-1)*sd(outcome.R)) + ((length(outcome.F)-1)*sd(outcome.F))
  sd.pooled.denom &lt;- (length(outcome.R)-1) + (length(outcome.F)-1)
  sd.pooled &lt;- sd.pooled.num/sd.pooled.denom
  sqrt(inside.sqrt)/sd.pooled
}

erfcinv &lt;- function(x) qnorm(x / 2, lower.tail = FALSE) / sqrt(2)

pss &lt;- function(x, par) {
  return((x &gt; 0) * par[1] + (1 - par[1]) * pnorm(x, par[2], par[3]))
}

inverseCdf &lt;- function(p, par) {

  thresh0 &lt;- pss(0, par)
  thresh1 &lt;- pss(0 + 1e-100, par)
  out &lt;- numeric(length(p))

  idx1 &lt;- p &lt; thresh0 | p &gt; thresh1 # where F(p) != 0
  idx0 &lt;- p[idx1] &gt;= thresh1 # where F(p) &lt; 0

  out[idx1] &lt;- par[2] - sqrt(2) * par[3] * erfcinv(2 * (par[1]*idx0 - p[idx1]) / (par[1] - 1))
  return(out)
}

postStat &lt;- function(par) {
  # lower &lt;- myQ(.025, par=par)
  # error(lower, 0.025, par) &gt; error(0.1, 0.025, par)
  # diff &lt;- 0.025 - pss(lower, par)
  # upper &lt;- myQ(.975 - diff, par)
  # browser()
  # curve(pss(x, par), from = -2, to = 2, n = 2^12)
  lower &lt;- inverseCdf(0.025, par)
  diff &lt;- 0.025 - pss(lower, par)
  upper &lt;- inverseCdf(0.975 - diff, par)
  if (upper == 0) upper &lt;- upper + 1e-100
  diff &lt;- 0.975 - pss(upper, par)
  lower &lt;- inverseCdf(0.025 - diff, par)
  pss(upper, par) - pss(lower, par)
  me &lt;- par[2] * (1 - par[1])
  return(c(&quot;lower&quot; = lower, &quot;upper&quot; = upper, &quot;model averaged&quot; = me))
}

bf &lt;- function(d, n, v0) {
  a &lt;- 1 / sqrt(n * (v0 + 1))
  b &lt;- n^2 * d^2
  c &lt;- 2 * (n + 1 / v0)
  return(a * exp(b / c))
}

updatePar &lt;- function(rho0, v0, N, ybar) {
  prec &lt;- (N + 1 / v0)
  v1 &lt;- 1 / prec
  c &lt;- N * ybar
  mu1 &lt;- v1 * c
  w &lt;- bf(ybar, N, v0)
  rho1 &lt;- rho0 / (rho0 + (1 - rho0) * w)
  return(c(&quot;ph0&quot; = rho1, &quot;mu&quot; = mu1, &quot;sd&quot; = sqrt(v1)))
}</code></pre>
</div>
<div id="update-paramenter" class="section level3">
<h3>Update Paramenter</h3>
<pre class="r"><code>priorPH0  &lt;- 0.5
sigmaSlab &lt;- 1

# explicit
# datExplBlock1 &lt;- subset(datExpl, ValenceBlock == &quot;1&quot; &amp; Block == &quot;1&quot;)$DV
# datExplBlock2 &lt;- subset(datExpl, ValenceBlock == &quot;1&quot; &amp; Block == &quot;2&quot;)$DV

ybarExpl &lt;- get.dMACS(y.R, y.F, eta)
nExpl &lt;- length(y.R)

upMAExpl &lt;- updatePar(priorPH0, sigmaSlab, nExpl, ybarExpl[1L])
ciMAExpl &lt;- postStat(upMAExpl)

tbExplicit &lt;- data.frame(t(c(upMAExpl, ciMAExpl)))
names(tbExplicit) &lt;- c(&quot;ph0&quot;, &quot;mu1&quot;, &quot;sd1&quot;, &quot;Lower&quot;, &quot;Upper&quot;, &quot;modelAveraged&quot;)

tbExplicit</code></pre>
<pre><code>##            ph0       mu1        sd1     Lower     Upper modelAveraged
## 1 9.986886e-19 0.6633703 0.07035975 0.5254677 0.8012728     0.6633703</code></pre>
<p>Ta da! So we get the posterior mean dMACs estimate of .66 which is
about the same as the original esimate calculated. Now all that’s is
left to do multiply this by the posterior probability of dMACS having a
real effect which is 1 - Ph0(the probability that there is an effect of
zero).</p>
<pre class="r"><code>dMACS_Shrunk &lt;- (1-tbExplicit[1])*tbExplicit[2]
dMACS_Shrunk</code></pre>
<pre><code>##         ph0
## 1 0.6633703</code></pre>
<p>And there we have it! dMACS_Shrunk in action!</p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
